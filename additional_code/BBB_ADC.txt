/*
 * NOE THAT: resolution: 12-bit
 * Max input voltage: 1.8 Volt
 * Return Value is in "milli volt"
 * Connectpin34 (GNDA_ADC to common ground*/


#include <stdio.h>
#include <time.h>

#define RET_OK  0
#define RET_NOK -1



void pauseSec(int sec);
int ADC_Init(void);
int ADC_Read_Pin(unsigned int pinNumber, unsigned int *readValue);
#define MGRNUM	8

int main()
{

	ADC_Init();
	unsigned int value = 0;
	while(1)
	{
		ADC_Read_Pin(0, &value);
		printf("VALUE: %d\n", value);
		pauseSec(1);

	}
	return 0;
}

void pauseSec(int sec)
{
	time_t now,later;

	now = time(NULL);
	later = time(NULL);

	while((later - now) < (double)sec)
		later = time(NULL);
}

int ADC_Init(void)
{
	FILE *ain;
	ain = fopen("/sys/devices/bone_capemgr.8/slots", "w");
	if(ain == NULL)
		return RET_NOK;
	fseek(ain,0,SEEK_SET);
	fprintf(ain,"cape-bone-iio");
	fflush(ain);
	fclose(ain);
	return RET_OK;
}

int ADC_Read_Pin(unsigned int pinNumber, unsigned int *readValue)
{
	FILE *aval;
	int value;
	char buf[50] = {0};
	sprintf(buf, "/sys/devices/ocp.2/helper.14/AIN%d", pinNumber);
	aval = fopen(buf, "r");
	if(aval == NULL)
		return RET_NOK;
	fseek(aval,0,SEEK_SET);
	fscanf(aval,"%d",&value);
	fflush(aval);
	fclose(aval);
	*readValue = value;
	return RET_OK;
}

